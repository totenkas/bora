import*as e from"ev-emitter";var t="default"in e?e.default:e;var i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var o={};(function(e,i){o?o=i(e,t):e.imagesLoaded=i(e,e.EvEmitter)})("undefined"!==typeof window?window:o,(function factory(e,t){let o=e.jQuery;let s=e.console;function makeArray(e){if(Array.isArray(e))return e;let t="object"==typeof e&&"number"==typeof e.length;return t?[...e]:[e]}
/**
   * @param {[Array, Element, NodeList, String]} elem
   * @param {[Object, Function]} options - if function, use as callback
   * @param {Function} onAlways - callback function
   * @returns {ImagesLoaded}
   */function ImagesLoaded(e,t,n){if(!((this||i)instanceof ImagesLoaded))return new ImagesLoaded(e,t,n);let r=e;"string"==typeof e&&(r=document.querySelectorAll(e));if(r){(this||i).elements=makeArray(r);(this||i).options={};"function"==typeof t?n=t:Object.assign((this||i).options,t);n&&this.on("always",n);this.getImages();o&&((this||i).jqDeferred=new o.Deferred);setTimeout((this||i).check.bind(this||i))}else s.error(`Bad element for imagesLoaded ${r||e}`)}ImagesLoaded.prototype=Object.create(t.prototype);ImagesLoaded.prototype.getImages=function(){(this||i).images=[];(this||i).elements.forEach((this||i).addElementImages,this||i)};const n=[1,9,11];
/**
   * @param {Node} elem
   */ImagesLoaded.prototype.addElementImages=function(e){"IMG"===e.nodeName&&this.addImage(e);true===(this||i).options.background&&this.addElementBackgroundImages(e);let{nodeType:t}=e;if(!t||!n.includes(t))return;let o=e.querySelectorAll("img");for(let e of o)this.addImage(e);if("string"==typeof(this||i).options.background){let t=e.querySelectorAll((this||i).options.background);for(let e of t)this.addElementBackgroundImages(e)}};const r=/url\((['"])?(.*?)\1\)/gi;ImagesLoaded.prototype.addElementBackgroundImages=function(e){let t=getComputedStyle(e);if(!t)return;let i=r.exec(t.backgroundImage);while(null!==i){let o=i&&i[2];o&&this.addBackground(o,e);i=r.exec(t.backgroundImage)}};
/**
   * @param {Image} img
   */ImagesLoaded.prototype.addImage=function(e){let t=new LoadingImage(e);(this||i).images.push(t)};ImagesLoaded.prototype.addBackground=function(e,t){let o=new Background(e,t);(this||i).images.push(o)};ImagesLoaded.prototype.check=function(){(this||i).progressedCount=0;(this||i).hasAnyBroken=false;if(!(this||i).images.length){this.complete();return}let onProgress=(e,t,i)=>{setTimeout((()=>{this.progress(e,t,i)}))};(this||i).images.forEach((function(e){e.once("progress",onProgress);e.check()}))};ImagesLoaded.prototype.progress=function(e,t,o){(this||i).progressedCount++;(this||i).hasAnyBroken=(this||i).hasAnyBroken||!e.isLoaded;this.emitEvent("progress",[this||i,e,t]);(this||i).jqDeferred&&(this||i).jqDeferred.notify&&(this||i).jqDeferred.notify(this||i,e);(this||i).progressedCount===(this||i).images.length&&this.complete();(this||i).options.debug&&s&&s.log(`progress: ${o}`,e,t)};ImagesLoaded.prototype.complete=function(){let e=(this||i).hasAnyBroken?"fail":"done";(this||i).isComplete=true;this.emitEvent(e,[this||i]);this.emitEvent("always",[this||i]);if((this||i).jqDeferred){let e=(this||i).hasAnyBroken?"reject":"resolve";(this||i).jqDeferred[e](this||i)}};function LoadingImage(e){(this||i).img=e}LoadingImage.prototype=Object.create(t.prototype);LoadingImage.prototype.check=function(){let e=this.getIsImageComplete();if(e)this.confirm(0!==(this||i).img.naturalWidth,"naturalWidth");else{(this||i).proxyImage=new Image;(this||i).img.crossOrigin&&((this||i).proxyImage.crossOrigin=(this||i).img.crossOrigin);(this||i).proxyImage.addEventListener("load",this||i);(this||i).proxyImage.addEventListener("error",this||i);(this||i).img.addEventListener("load",this||i);(this||i).img.addEventListener("error",this||i);(this||i).proxyImage.src=(this||i).img.currentSrc||(this||i).img.src}};LoadingImage.prototype.getIsImageComplete=function(){return(this||i).img.complete&&(this||i).img.naturalWidth};LoadingImage.prototype.confirm=function(e,t){(this||i).isLoaded=e;let{parentNode:o}=(this||i).img;let s="PICTURE"===o.nodeName?o:(this||i).img;this.emitEvent("progress",[this||i,s,t])};LoadingImage.prototype.handleEvent=function(e){let t="on"+e.type;(this||i)[t]&&this[t](e)};LoadingImage.prototype.onload=function(){this.confirm(true,"onload");this.unbindEvents()};LoadingImage.prototype.onerror=function(){this.confirm(false,"onerror");this.unbindEvents()};LoadingImage.prototype.unbindEvents=function(){(this||i).proxyImage.removeEventListener("load",this||i);(this||i).proxyImage.removeEventListener("error",this||i);(this||i).img.removeEventListener("load",this||i);(this||i).img.removeEventListener("error",this||i)};function Background(e,t){(this||i).url=e;(this||i).element=t;(this||i).img=new Image}Background.prototype=Object.create(LoadingImage.prototype);Background.prototype.check=function(){(this||i).img.addEventListener("load",this||i);(this||i).img.addEventListener("error",this||i);(this||i).img.src=(this||i).url;let e=this.getIsImageComplete();if(e){this.confirm(0!==(this||i).img.naturalWidth,"naturalWidth");this.unbindEvents()}};Background.prototype.unbindEvents=function(){(this||i).img.removeEventListener("load",this||i);(this||i).img.removeEventListener("error",this||i)};Background.prototype.confirm=function(e,t){(this||i).isLoaded=e;this.emitEvent("progress",[this||i,(this||i).element,t])};ImagesLoaded.makeJQueryPlugin=function(t){t=t||e.jQuery;if(t){o=t;o.fn.imagesLoaded=function(e,t){let s=new ImagesLoaded(this||i,e,t);return s.jqDeferred.promise(o(this||i))}}};ImagesLoaded.makeJQueryPlugin();return ImagesLoaded}));var s=o;export{s as default};

